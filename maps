"
" scott@smemsh.net
" http://smemsh.net/src/.vim/
" http://spdx.org/licenses/GPL-2.0
"
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

" buffer selection
"
nmap <c-j>              <c-w>j
nmap <c-k>              <c-w>k
nmap <c-y>              <c-w>p
nmap <c-n>              :bn<return>
nmap <c-p>              :bp<return>
nnoremap <leader>.      :b#<return>
nmap <leader><space>    :wincmd p<return>

" to tabs (T), to spaces (t)
"
nmap <leader>t          :set expandtab<return> :retab!<return>
nmap <leader>T          :set noexpandtab<return> :retab!<return>

" temporal undo
"
nmap -                  g-
nmap +                  g+
nmap =                  g+

" clear settings
"
nmap <leader>c          :set noai nosi nocin tw=0 fo-=a indentexpr=<return>
nmap <leader>5          :set tw=55<return>
nmap <leader>6          :set tw=62<return>
nmap <leader>7          :set tw=72<return>
nmap <leader>0          :set tw=0<return>

" change fold levels
"
nmap <leader><leader>f  :set foldlevel+=1<return>
nmap         <leader>f  :set foldlevel-=1<return>

" auto-format +/-
"
nmap <leader><leader>a  :set formatoptions+=a<return>
nmap         <leader>a  :set formatoptions-=a<return>
nmap         <leader>N  :set fo+=n<return>
nmap         <leader>n  :set fo-=n<return>

" editing toggles
"
nmap         <leader>p  :set paste!<return>
nmap         <leader>w  :set wrap!<return>
nmap         <leader>L  :set list!<return>
nmap         <leader>R  :set wrap nolist showbreak=
                        \ breakindent linebreak<return>
nmap <leader><leader>R  :set nowrap list showbreak="> "
                        \ nobreakindent nolinebreak<return>

" for outlines and similar
"
nmap <leader>o          :set tabstop=4 shiftwidth=4 indentexpr=
                        \ noexpandtab<return>

" for text/flowed: open fixed 80col win, wrap at word breaks
"
nmap <leader>v          :set formatoptions-=a textwidth=0 nolist
                        \ wrap linebreak showbreak= <return>
                        \:match WarningMsg ''<return>
                        \:24vspl /dev/null<return>

" quickfix prev-next maps to vi left-right but one row down
"
nmap <c-m>              :cp<return>
nmap <c-/>              :cn<return>

" quickfix-next workaround for osx, which cannot seem seem
" to map <c-/> for some reason: Terminal.app will not
" generate this keycode, so we use KeyRemap4Macbook on that
" platform to have keyscan <c-/> emit keycode <c-_>
"
" TODO: why does this key work fine on Linux terminals?
"
nmap <c-_>              :cn<return>

" temporary solution to having nonfunctioning F-keys
"
noremap <f1>            <c-^>
noremap <c-^>           <f1>

" screen redraw
"
nmap <leader><leader>l  :redraw!<return>
nmap <c-l>              :redraw!<return>

" reload current colorscheme
"
nmap <leader>C          <esc>:call Reload_colorscheme()<return>

" type while inserting, inputs the date, and then continues
" appending in insert mode after going to the end of the new
" date
"
map! <leader><leader>d  <esc>:call Read_shell_histtimeformat()<return>
                        \Ea<space>

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

" for editing Trac wiki RST
"
map <leader><leader>r   :set fo-=a<return>
                        \a{{{<return>#!rst<return><return><return><return>}}}
                        \<esc>kka<esc>
                        \:set ft=rst nospell tw=72 fo-=a<return>
                        \i

map <leader>r           \:set nospell ft=rst<return>

map <leader>q           m`WBi``<esc>Ea``<esc>`` | " quote
nmap <leader><leader>9  a`#99999`:trac:<esc>

" mutt signatures with and without the horiz underline
" TODO remove personalizations into separate file and git-crypt it,
"      these are safe for the time being
"
nmap <leader><leader>s  ,c0o--<space><return>
                        \Scott<esc>
nmap <leader><leader>S  ,,sa<return><return><esc>
                        \78i_<esc>
                        \A<return><esc>
nmap <leader><leader>o  ,c0o--<space><esc>
                        \:read<space>~/.mutt/crypt/signature.smemsh<return>
                        \<esc>
nmap <leader><leader>O  ,c0,,o}A<return><esc>
                        \78i_<esc>
                        \A<return><esc>

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
"
" diff this buffer against the pristine version and use
" split screen to show differences, of course will look
" better on larger screen
"
if ! exists(":DiffOrig")
command DiffOrig
	\ vert new              |
	\ set bt=nofile         |
	\ r #                   |
	\ 0d_                   |
	\ diffthis              |
	\ wincmd p              |
	\ diffthis
nmap <leader>d :DiffOrig<return>
endif

" diff from local version
nnoremap < :diffget LOCAL<return>:diffupdate<return>

" diff from remote version
nnoremap > :diffget REMOTE<return>:diffupdate<return>

" resync diff highlighting
nnoremap <leader>$ :diffupdate<return>

" write this buffer and quit others (they should have no changes)
nnoremap <leader>x :w<return>:qa<return>
